---
title: Where to rebuild after the War
author: Parth Khare CGD
date: '2022-09-15'
# slug: []
# categories: []
# tags: []
# description: ~
# toc: yes
# authors: []
# series: []
# lastmod: '2022-09-15T21:22:57-04:00'
# featuredVideo: https://www.youtube.com/watch?v=uUFh3bpq-bA
# featuredImage: /ukraine/UkrJan2022.png
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
library(ggplot2); library(data.table);library(fixest);library(raster);library(rasterVis)
library(animation); library(mapview); library(leaflet); library(RColorBrewer)
options(scipen=99)

# For Color Combos382 palette
ntlcol <- c("#09090c", "#19192f",'#1212b8','#f39C12',"#ffb300",'#FFC300',"#ffe200")

# Cuts
cuts=c(0,1,2,5,10,20,50,100,500,65535)
mntit <- c("NTL_Feb22","NTL_Mar22","NTL_Apr22","NTL_May22","NTL_Jun22")

```


Each passing day of the Ukrainian invasion is taking a toll on not only the lives but the future livelihood of millions. With optimism on war nearing its end, its important to start taking stock of the extent of loss in public infrastructure, natural-resources and identifying worst hit regions. Doing so, will not only help in targeting focused reparative efforts but also save time in policy response till surveys and ground assessments are undertaken and collected.

In the absence of real time data, satellite data can be a handy proxy Imagery from daytime satellites have already proven to be useful in preventive mobilization before the invasion started [encroachment by Russian army](https://www.space.com/russia-ukraine-invasion-satellite-photos), learning of Russia strategically targeted [Ukrainian grains](https://www.wired.com/story/satellites-ukraine-russia-grain/). Data from nightlights can further help in assessing the extent of economic disruption from loss in electrification, demolition of private property and public infrastructure.



## Assessing impact of war in Ukarine from nightlights
The following maps show the drastic drop in nightlights across Ukraine from January to May 2022.

```{r message=F,echo=F,warning=FALSE, }
pthuk <- "/Users/parthkhare/Desktop/CGD/Projects/Ukraine FB Mobility NTL/nightlights/Ukraine mosaics/2022"
alras <- list.files(pthuk, pattern = ".*tif", full.names = T)

rjan <-  raster(alras[3])
proj4string(rjan) <- CRS("+init=epsg:4326")

rfeb <-  raster(alras[2])
rmar <-  raster(alras[6])
rapr <-  raster(alras[1])
rmay <-  raster(alras[7])
proj4string(rmay) <- CRS("+init=epsg:4326")

rjun <-  raster(alras[5])
rjul <-  raster(alras[4])


# Plot January raster 
levelplot(rjan, at=cuts, par.settings=rasterTheme(ntlcol),main='Before Invasion: Jan 2022',
          sub=expression(Watt/cm2/sr),pretty=T,maxpixels = 8222466, margin=F)
# mapView(rjan, col.regions = ntlcol, at=cuts, maxpixels=8222466, alpha.regions = 0.9, zoom=6)

# Plot May raster 
levelplot(rmay, at=cuts, par.settings=rasterTheme(ntlcol),main='After Invasion: May 2022',
          sub=expression(Watt/cm2/sr),pretty=T,maxpixels = 8222466, margin=F)
# mapView(rmay, col.regions = ntlcol, at=cuts, maxpixels=8222466, alpha.regions = 0.9,zoom=6)

```
<br />

It can be seen that light intensity in highly-lit (bright yellow) regions, corresponding to cities including Kyiv, Lyiv, Kharkhiv have drastically reduced since January and continue on a downward trend. Milder yellow/orange regions potnetially capturing street lights from highways have almost disappeared, matching with [ongoing narrative ](https://www.kyivpost.com/ukraine-politics/during-100-days-invaders-destroy-24000-km-of-roads-300-bridges.html) from the ground. Lights from dark blue regions capturing small settlement have almost disappeared.



<br />
<br />



## Checking confounders I (Blackouts): Electricity Demand

Its highly likely that the such drastic reduction in light could be driven by a.) cloud-cover [biophysical, seasonal noise](https://nightlights-econ.netlify.app/posts/2021-10-14-cleaning-variants/) and b.) [strategic blackouts](https://www.nytimes.com/2022/09/12/world/ukraine-power-blackout.html) to stave off air-strikes. Assuming that the blackouts were not consistent across all the months, checking with electricity demand could potentially help in account for this. Following is chart of monthly [electricity demand estimated by the IEA](https://www.iea.org/data-and-statistics/data-tools/ukraine-real-time-electricity-data-explorer)


![](/ukraine/Ukrelecdd.png)

<br />

[source](https://www.iea.org/data-and-statistics/data-tools/ukraine-real-time-electricity-data-explorer)


It can be seen that the drop in lights match with the drop in monthly electricity, with a stark drop in May 2022 onwards and marginally decreasing levels after April. This seems to confirm the perception, direction, and magnitude of the fall. It can also be seen that the drop in lights is pronounced in eastern part of the country coinciding with  Possibly implying that the drop in lights was not just due to cloud cover or blackouts but largely from loss in infrastructure and breakdown of economic activity. 



## Checking confounders I (Seasonal Noise): Compare with 2021 Data

```{r message=F, echo=F, warning=F}

# 2021 Data
# ---------------------------
pthuk21 <- "/Users/parthkhare/Desktop/CGD/Projects/Ukraine FB Mobility NTL/nightlights/Ukraine mosaics/2021"
alras21 <- list.files(pthuk21, pattern = ".*tif", full.names = T)

# Reas rasters 2021
rjan21 <-  raster(alras21[3])
rfeb21 <-  raster(alras21[2])
rmar21 <-  raster(alras21[6])
rapr21 <-  raster(alras21[1])
rmay21 <-  raster(alras21[7])
rjun21 <-  raster(alras21[5])
rjul21 <-  raster(alras21[4])


# 2021 Map
# ---------------------------
cuts=c(0,1,2,5,10,20,50,100,500,65535)

levelplot(rjan21, at=cuts, par.settings=rasterTheme(ntlcol),main='Jan 2021',
          sub=expression(Watt/cm2/sr),pretty=T,maxpixels = 8222466, margin=F)

levelplot(rmay21, at=cuts, par.settings=rasterTheme(ntlcol),main='May 2021',
          sub=expression(Watt/cm2/sr),pretty=T,maxpixels = 8222466, margin=F)
# levelplot(rjul21, at=cuts, par.settings=rasterTheme(ntlcol),main='July 2021',
#           sub=expression(Watt/cm2/sr),pretty=T,maxpixels = 8222466, margin=F)
```





### Monthly nightlights map

```{r message=F,echo=F,warning=FALSE}
# Method II: leaflet
cuts2=c(0,2,5,10,20,50,100,500,65535)

# Nightlights color bin
ntlcb <- colorBin(palette = ntlcol, bins = cuts2, domain = cuts2)


leaflet() %>% addTiles() %>%
  addProviderTiles(providers$CartoDB.Positron, group = "Carto") %>%
  addRasterImage(rjan, at=cuts2, colors = ntlcb, opacity = 0.9, group="Jan-2022") %>%
  addRasterImage(rfeb, at=cuts2, colors = ntlcb, opacity = 0.9, group="Feb-2022") %>%
  addRasterImage(rmar, at=cuts2, colors = ntlcb, opacity = 0.9, group="Mar-2022") %>%
  addRasterImage(rapr, at=cuts2, colors = ntlcb, opacity = 0.9, group="Apr-2022") %>%
  addRasterImage(rmay, at=cuts2, colors = ntlcb, opacity = 0.9, group="May-2022") %>%
  addLayersControl(overlayGroups = c("Jan-2022","Feb-2022","Mar-2022","Apr-2022","May-2022"),
                   options = layersControlOptions(collapsed = FALSE)) %>% 
  hideGroup(c("Feb-2022", "Mar-2022","Apr-2022","May-2022"))  %>%
  addLegend(pal=ntlcb, values=cuts2,position = "bottomleft")
```

<br />
<br />


Drop in nightlights across months

![](UkrNtl_lres.gif)


### Caveat: Limitation on inferences to be drawn from nightlights
NOTE
  - It should be remembered that lights are not exactly income. While they can be used and have proven to be a helpful proxy for estimating economic growth. 
  - Nightlight measures radiance of light in Watt/cm2/sr, and all the maps here use the same legend for comparing results ovetime
  - Nightlights data for month of June seems to been biased by external noise from bombing and is not included here
  - Nightlights map can be misleading with different color labels, the labels used here are based 

